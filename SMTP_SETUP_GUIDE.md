# 📧 Gmail SMTP 完整配置指南

## ⚠️ 重要说明

Google在2024年加强了安全策略，**不再支持传统用户名/密码方式**，但**应用密码（App Password）仍然是官方支持的安全方案**！

## 🔑 获取Gmail应用密码（必需步骤）

### 第一步：启用两步验证

1. **登录Gmail账户** → 点击右上角头像 → **管理您的Google账户**
2. **左侧菜单** → **安全性**
3. **登录Google** → **两步验证** → **开始使用**
4. **验证手机号码**：
   - 输入手机号码
   - 选择接收方式（短信/语音）
   - 输入验证码
   - 点击**启用**

### 第二步：生成应用密码

**方法一：快速链接（推荐）**
```
直接访问：https://myaccount.google.com/apppasswords
```

**方法二：手动导航**
1. Google账户 → **安全性**
2. **两步验证** → 滚动到底部
3. **应用专用密码** → 点击右箭头
4. 如果找不到，搜索栏输入"app passwords"

### 第三步：创建专用密码

1. **选择应用** → **其他（自定义名称）**
2. **输入名称**：`Gmail转发系统` 或 `SMTP发送`
3. 点击**生成**
4. **复制16位密码**（格式：xxxx xxxx xxxx xxxx）
5. ⚠️ **立即保存**：这个密码只显示一次！

## ⚙️ SMTP配置参数

### 标准配置

```bash
# Gmail SMTP 配置
SMTP_HOST=smtp.gmail.com
SMTP_PORT=587
SMTP_USER=your_email@gmail.com
SMTP_PASSWORD=your_16_digit_app_password  # 注意：去掉空格！
```

### 详细参数

| 参数 | 值 | 说明 |
|------|-----|------|
| **服务器** | `smtp.gmail.com` | Gmail SMTP服务器 |
| **端口** | `587` (TLS) 或 `465` (SSL) | 推荐587 |
| **安全协议** | `TLS` 或 `SSL` | 推荐TLS |
| **用户名** | `your_email@gmail.com` | 完整邮箱地址 |
| **密码** | `16位应用密码` | ⚠️ 删除所有空格 |

### ⚠️ 重要注意事项

1. **删除空格**：应用密码复制时包含空格，使用时必须删除
   ```
   错误：abcd efgh ijkl mnop
   正确：abcdefghijklmnop
   ```

2. **不是Gmail登录密码**：应用密码≠Gmail密码

3. **保密存储**：应用密码泄露风险低，但仍需安全保存

## 🔧 不同账户类型的限制

| 账户类型 | 日发送限制 | 应用密码支持 | 推荐度 |
|---------|------------|-------------|--------|
| **免费Gmail** | 500封/天 | ✅ 完全支持 | 🏠 个人使用 |
| **Google Workspace** | 2,000封/天 | ✅ 完全支持 | 🏢 企业推荐 |
| **Gmail Business** | 3,000封/天 | ✅ 完全支持 | 🏭 大型企业 |

## 🧪 测试配置

### 使用curl测试

```bash
# 测试SMTP连接
curl --url 'smtps://smtp.gmail.com:465' \
     --ssl-reqd \
     --mail-from 'your_email@gmail.com' \
     --mail-rcpt 'test@example.com' \
     --user 'your_email@gmail.com:your_app_password'
```

### 常见错误排查

| 错误信息 | 原因 | 解决方案 |
|---------|------|----------|
| `Authentication failed` | 密码错误 | 检查应用密码，删除空格 |
| `Less secure app` | 未用应用密码 | 使用16位应用密码，非Gmail密码 |
| `Connection refused` | 端口/协议错误 | 使用587端口+TLS |

## 🔒 安全性说明

### 为什么应用密码是安全的？

1. **独立权限**：仅用于邮件发送，不能访问其他Google服务
2. **可撤销**：随时可以删除，不影响主账户
3. **专用性**：每个应用一个密码，便于管理
4. **审计**：Google记录使用情况，便于监控

### 最佳实践

- ✅ **每个应用使用独立的应用密码**
- ✅ **定期更换应用密码**
- ✅ **不再使用时立即删除**
- ✅ **安全存储，避免明文**

## 🚨 常见问题

**Q: 为什么看不到"应用密码"选项？**
A: 必须先启用两步验证，然后等待几分钟生效。

**Q: 应用密码会过期吗？**
A: 不会自动过期，但建议定期更换。

**Q: 可以用Gmail登录密码吗？**
A: 不可以！必须使用16位应用密码。

**Q: 企业账户有限制吗？**
A: Google Workspace管理员可能禁用应用密码，需要联系IT部门。

---

## 🎯 快速配置清单

- [ ] ✅ 启用Gmail两步验证
- [ ] ✅ 生成16位应用密码
- [ ] ✅ 删除密码中的空格
- [ ] ✅ 配置SMTP参数
- [ ] ✅ 测试发送功能
- [ ] ✅ 安全保存应用密码

**🎉 完成后，您的Gmail SMTP就可以安全高效地发送邮件了！** 